<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<link rel="stylesheet" href="dsk_sakura.css" type="text/css">
<link rel="shortcut icon" href="images/favicon.ico">
<TITLE>概要</TITLE>
<META NAME="MS-HKWD" CONTENT="概要">
</HEAD>
<BODY>
<script type="text/javascript" src="item.js"></script>
<noscript>[<a href="index.html">目次</a>] <br></noscript>
<!--
<noscript>[<a href="index.html">目次</a>] [<a href="web_frame.html" target="_top">フレームで表示</a>] [<a href="web_search.html">検索</a>]<br></noscript>
-->
<br>
<h2>2. 概要</h2>

<h3 id=c0201>2.1. 利用イメージ</h3>
<div class=li200>
・ネット上からプラグインのzipファイルをダウンロードする。<br>
・ダウンロードしたファイルを解凍し、sakura/plugins/ 配下にフォルダを作って配置する。<br>
　あるいはユーザ別設定が有効な場合、ユーザ別フォルダ（sakura.iniがある）配下のpluginsフォルダに配置することができる。<br>
　以下、pluginsをプラグインフォルダと呼び、その下のプラグインごとのフォルダを個別フォルダと呼ぶ。<br>
・設定画面のプラグインタブからプラグインの追加を行う。<br>
・エディタ本体を再起動する（または新しいウィンドウを開く）とプラグインが読み込まれ、利用可能な状態になる。<br>
・プラグインのアンインストールは、設定画面からプラグインの削除を行う。<br>
・プラグインの新バージョンが出た場合は、個別フォルダの内容を上書きしてエディタを再起動することで更新できる。<br>
</div><br>

<h3 id=c0202>2.2. 動き</h3>
<div class=li200>
・エディタプロセスの起動時に、共通情報のプラグインテーブルを参照し、インストール済みのプラグインに対して以下の読み込み操作を行う。<br>
　個別フォルダ内にはプラグインの情報を記述したテキストファイル(plugin.def)があり、エディタはまずこのテキストファイルを読み込む。<br>
　以下、このファイルをプラグイン定義ファイルと呼ぶ。<br>
<br>
　また、プラグインフォルダ直下に、プラグインごとのテキストファイルを置き、そこにプラグインのオプションなど可変の情報を記述する。<br>
　以下、このファイルをオプションファイルと呼ぶ。<br>
　ファイル名は "個別フォルダ名.ini" とする。<br>
　プラグイン定義ファイルのOptionセクションで指定した項目は、共通設定のプラグイン個別設定から値を編集できる。<br>
<br>
・プラグイン定義ファイルの内容に従い、メモリ上にプラグインオブジェクトを作成する。<br>
<br>
・プラグイン定義ファイルの内容に従い、エディタ内の各機能にあらかじめ設定された、プラグイン可能な箇所に、プラグインの関数（プラグ）を関連付ける。<br>
　以下、プラグイン可能な箇所をジャック（プラグをさす穴）と呼ぶ。<br>
<br>
・エディタを操作し、ジャックに達したら、関連付けられている全てのプラグを実行する。アウトライン解析やスマートインデントはタイプ別設定で選択したもの一つだけを実行する。<br>
<br>
・エディタプロセスの終了時に、読み込まれていたプラグインはすべて解放する。<br>
<br>
・プラグインは、コンパイルされたDLLや、WSHで実行できるマクロ言語などに対応する。ただし一度読み込んだ後は、違いを意識せずに操作できる。<br>
　（現時点でDLLプラグインはまだ使い物にならない）<br>
</div><br>

<h3 id=c0203>2.3. フォルダ構成</h3>
<div class=li300>
<pre>
Program Files/
  └ sakura/
      ├ sakura.ini
      └ plugins/
          ├ ○○.ini           // オプションファイル
          ├ ××.ini
          ├ ○○/              // 個別フォルダ
          │  ├ plugin.def     // プラグイン定義ファイル
          │  ├ readme.txt     // プログラム等
          │  ├ ○○_A.js
          │  └ ○○_B.js
          └ ××/
              ├ plugin.def
              └ ××.dll       // dllにも対応できたり・・・
</pre>
</div><br>

<h3 id=c0204>2.4. ER図</h3>
<div class=li200>
<table class=er>
<tr><td class=er>エディタ本体</td><td>1 - *</td><td class=er>プラグイン</td>
	<td>複数のプラグインをエディタで使うことができる。</td></tr>
<tr><td class=er>エディタ本体</td><td>1 - *</td><td class=er>ジャック</td>
	<td>エディタには複数のジャック（プラグイン可能箇所）がある。</td></tr>
<tr><td class=er>プラグイン  </td><td>1 - *</td><td class=er>プラグ</td>
	<td>プラグインは複数のプラグ（実行単位）を持つ。</td></tr>
<tr><td class=er>ジャック    </td><td>1 - *</td><td class=er>プラグ</td>
	<td>ジャックには複数のプラグを関連付けることができる。</td></tr>
</table>
</div><br>

<h3 id=c0205>2.5. ジャック一覧</h3>
<div class=li200>
<table class=box>
<tr><th class=box>プラグインの種類</th><th class=box>ジャック名<br>([Plug]で定義)</th><th class=box><em>ジャック名</em>.Label</th><th class=box>インタフェースオブジェクト</th></tr>
<tr><td class=box><a href="implementation03.html#c030301">アウトライン解析</a></td><td class=box>Outline</td><td class=box>アウトライン標準ルール選択肢</td><td class=box><a href="implementation02.html#c030203">Outline</a></td></tr>
<tr><td class=box><a href="implementation03.html#c030302">スマートインデント</a></td><td class=box>Indent</td><td class=box>スマートインデント選択肢</td><td class=box><a href="implementation02.html#c030204">Indent</a></td></tr>
<tr><td class=box rowspan=2><a href="implementation03.html#c030303">補完候補検索</a></td><td class=box>ComplementGlobal</td><td class=box>no</td><td class=box rowspan=2><a href="implementation02.html#c030205">Complement</a></td></tr>
<tr><td class=box>Complement</td><td class=box>入力補完機能選択肢</td></tr>
<tr><td class=box rowspan=6><a href="implementation03.html#c030304">エディタイベント</a><em>*1</em></td><td class=box>EditorStart</td><td class=box>no</td><td class=box rowspan=6></td></tr>
<tr><td class=box>EditorEnd</td><td class=box>no</td></tr>
<tr><td class=box>DocumentOpen</td><td class=box>no</td></tr>
<tr><td class=box>DocumentClose</td><td class=box>no</td></tr>
<tr><td class=box>DocumentBeforeSave</td><td class=box>no</td></tr>
<tr><td class=box>DocumentAfterSave</td><td class=box>no</td></tr>
<tr><td class=box>コマンド追加</td><td class=box>[Command]で定義</td><td class=box>コマンドの表示名</td></tr>
</table>
<em>*1 Ver.2.0.8.0で追加予定</em><br>
</div><br>

<center><a href="beginning.html">前へ＜</a>　　<a href="implementation01.html">＞次へ</a></center>
</BODY></HTML>
